{"ops":[{"insert":"这是一个基于 Vue.js 和 TypeScript 开发的权限申请对话框组件，主要用于在用户没有某业务权限时，展示权限申请指引并引导用户进行相关操作。\n\n基本用途"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n- 当前用户访问某个业务（如蓝鲸监控、蓝鲸 CI/CD、蓝鲸 SaaS 等）时，**如果没有对应业务的权限**，则通过弹出对话框的形式告知用户，并提供**明确的权限申请途径和联系方式**。\n- 引导用户通过加入用户组、联系管理员或查看权限申请文档等方式获取权限。\n- 是一个**可复用的弹窗组件**，通过统一的接口 `showAccessRequest` 被其他模块调用。\n\n主要功能"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n1. 权限不足提示"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 使用 `bk-exception` 组件展示一个“403无权限”的异常页面样式，提示用户当前没有某业务的权限。\n- 提示文案中会包含具体的业务名称（如“你当前暂无 xxx 业务权限”）。\n\n2. 权限申请方式引导"},{"attributes":{"header":2},"insert":"\n"},{"insert":"在弹窗中清晰列出三种权限申请或咨询方式：\n1. **推荐方式：加入用户组**\n   - 提供链接，用户点击后跳转到“申请加入用户组”页面，便于直接申请加入对应业务的用户组。\n2. **联系管理员**\n   - 如果无法找到对应的用户组，组件会展示该业务的管理员列表，用户可以直接联系他们申请权限。\n3. **查看权限申请文档**\n   - 提供一个链接，跳转到公司内部的权限申请帮助文档，用户可参考详细流程。\n\n3. 支持多种业务类型"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 支持不同类型的业务空间，比如：\n  - 普通业务（默认）\n  - BKCI（蓝鲸持续集成平台，如 Jenkins 等）\n  - BKSAAS（蓝鲸 SaaS 平台）\n- 根据业务类型（`spaceType`），动态调整跳转链接或提示信息，例如：\n  - 对于 BKCI 类型且无 spaceCode 的情况，直接跳转到指定的申请链接。\n  - 对于 BKSAAS，则在用户组名称前加上“开发者中心-”前缀。\n\n4. 动态获取业务信息"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 组件通过调用 `fetchBusinessInfo` API，根据传入的 `bizId` 获取该业务的详细信息，包括：\n  - 业务名称（`bk_biz_name`）\n  - 权限申请链接（`get_access_url`）\n  - 空间类型（`space_type_id`）\n  - 业务编码（`space_code`）\n  - 业务管理员列表（`operator`）\n\n5. 弹窗控制"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 使用的是蓝鲸 UI 组件库中的 `bk-dialog` 组件，实现了一个居中显示、不可拖拽、不可通过点击遮罩关闭、无底部按钮的提示弹窗。\n- 弹窗的显示/隐藏状态由父级或调用方控制（通过 `visible` 属性）。\n\n使用方法"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n1. 引入组件方式"},{"attributes":{"header":2},"insert":"\n"},{"insert":"该组件并不直接在页面中以标签形式使用，而是通过统一的**导出方法 `showAccessRequest`** 进行调用，这是一种**单例模式弹窗**的实现方式。\n\n2. 调用方法"},{"attributes":{"header":2},"insert":"\n"},{"insert":"在其他 Vue 组件或 JS 模块中，**引入并调用 `showAccessRequest` 方法即可弹出权限申请对话框**：\n\n\n"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"import { showAccessRequest } from '@/path/to/access-request-dialog';"},{"attributes":{"code-block":"ts"},"insert":"\n\n"},{"insert":"// 调用示例"},{"attributes":{"code-block":"ts"},"insert":"\n"},{"insert":"showAccessRequest('https://xxx.com/some-protected-page', '12345');"},{"attributes":{"code-block":"ts"},"insert":"\n\n"},{"insert":"\n参数说明："},{"attributes":{"header":1},"insert":"\n"},{"insert":"| 参数名         | 类型   | 必填 | 说明                                                         |\n| -------------- | ------ | ---- | ------------------------------------------------------------ |\n| originAccessURL | string | 是   | 用户尝试访问的原始 URL，用于生成“加入用户组”等跳转链接       |\n| bizId           | string | 否   | 业务 ID，默认为空。如果传入，则优先使用该 ID 获取业务信息；否则使用全局的 `window.cc_biz_id` |\n\n技术实现细节"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n1. 文件结构与职责"},{"attributes":{"header":2},"insert":"\n"},{"insert":"| 文件                   | 职责说明                                                                 |\n| ---------------------- | ------------------------------------------------------------------------ |\n| access-request-dialog.scss | 样式文件，定义了弹窗以及内容区域的样式，如字体大小、颜色、间距、布局等。       |\n| access-request-dialog.tsx | 主要逻辑与模板实现，Vue + TS + Vue Property Decorator，负责数据绑定、API 请求、事件处理、弹窗内容渲染。 |\n| index.ts               | 对外暴露统一的调用接口 `showAccessRequest`，控制弹窗实例的创建和显示逻辑。     |\n\n2. 关键逻辑说明"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- **获取业务信息：**\n\n"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  fetchBusinessInfo({ bk_biz_id: this.bizId || window.cc_biz_id })"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  通过业务 ID 获取当前业务的权限申请链接、管理员、空间类型等信息。\n\n- **管理员展示：**\n  将管理员数组通过 `reduce` 拼接成“张三、李四、王五”这样的字符串展示给用户。\n\n- **动态跳转链接：**\n  根据业务类型和参数拼接不同的跳转链接，比如加入用户组、权限文档等。\n\n- **弹窗单例控制：**\n  在 `index.ts` 中通过一个全局变量 `instance` 保证同一时间只存在一个权限申请弹窗，避免重复创建。\n\n依赖的外部组件 / 工具"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n- **Vue.js + TypeScript**：组件开发语言和框架。\n- **Vue Property Decorator / Vue TSX Support**：用于以类组件 + 装饰器方式编写 Vue 组件，并支持 TSX 模板。\n- **bk-dialog / bk-exception / bk-link**：来自蓝鲸前端组件库（BlueKing UI），用于弹窗、异常展示和链接组件。\n- **monitor-api / monitor-common**：项目内部封装的 API 模块和工具函数，如 `fetchBusinessInfo` 和 `skipToDocsLink`。\n- **i18n 国际化支持**：通过 `window.i18n.t()` 实现多语言文案展示。\n\n总结"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n这是一个**面向业务权限管控场景的用户友好型提示弹窗组件**，核心价值在于：\n\n- 当用户因缺乏权限无法访问某些功能或页面时，**不直接报错或阻断，而是引导用户通过正确途径申请权限**；\n- 提供清晰的操作步骤和入口，提升用户自助解决权限问题的效率；\n- 通过**统一接口调用 + 单例弹窗管理**，方便整个系统不同模块复用，保持交互一致。\n\n适用于蓝鲸体系内各业务系统（如监控、CI/CD、SaaS 平台等）在权限校验失败时的前端友好引导场景。\n"}],"extra":{"updator":"Austin","update_at":"2026-01-20 15:22:54"}}