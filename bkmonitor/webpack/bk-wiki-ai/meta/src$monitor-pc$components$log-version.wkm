{"ops":[{"insert":"基本用途"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n这是一个用于在网页中展示版本日志（更新日志）组件，主要功能是通过弹窗的形式向用户展示产品的历史版本信息，包括每个版本的标题、发布日期以及详细更新内容。同时具备记录用户是否已经查看过版本日志的机制，避免重复弹出。\n\n主要功能"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n1. 版本日志弹窗展示"},{"attributes":{"header":2},"insert":"\n"},{"insert":"   - 使用 `bk-dialog` 组件（可能来自蓝鲸前端组件库）弹出一个对话框，展示版本日志。\n   - 左侧是版本列表，显示各个版本的标题和发布日期，用户可点击切换。\n   - 右侧显示选中版本的详细更新内容（通过 `v-html` 渲染）。\n   - 支持拖拽、加载状态、自适应样式等交互细节。\n\n2. 版本数据获取"},{"attributes":{"header":2},"insert":"\n"},{"insert":"   - 通过 HTTP 请求（使用封装后的 `axios`）从后端接口获取：\n     - 版本列表（标题与日期）\n     - 每个版本对应的详细更新内容\n   - 支持开发环境和生产环境不同的接口地址配置（通过 `process.env.NODE_ENV` 和全局变量判断）。\n\n3. 版本日志显示控制"},{"attributes":{"header":2},"insert":"\n"},{"insert":"   - 利用 Cookie 记录用户是否已查看过版本日志：\n     - 如果用户之前未关闭版本日志弹窗（通过 Cookie `SHOW_VERSION_LOG=True` 判断），则在页面加载时自动弹出。\n     - 用户关闭日志弹窗后，会清除该 Cookie，避免重复提示。\n   - 提供 mixin (`log-version-mixin.js`)，可在其他 Vue 组件中混入，用于控制是否触发版本日志弹窗逻辑。\n\n使用方法"},{"attributes":{"header":1},"insert":"\n"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"<template>"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  <div>"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    <!-- 其它内容 -->"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    <LogVersion :dialog-show=\"isLogDialogVisible\" @update:dialog-show=\"isLogDialogVisible = $event\" />"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  </div>"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"</template>"},{"attributes":{"code-block":"vue"},"insert":"\n\n"},{"insert":"<script>"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"import LogVersion from './log-version.vue';"},{"attributes":{"code-block":"vue"},"insert":"\n\n"},{"insert":"export default {"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  components: {"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    LogVersion,"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  },"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  data() {"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    return {"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"      isLogDialogVisible: false, // 控制弹窗是否显示"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    };"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  },"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  mounted() {"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    // 根据业务逻辑决定是否显示版本日志"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    // 例如首次访问、或满足某些条件时："},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"    this.isLogDialogVisible = true;"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"  },"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"};"},{"attributes":{"code-block":"vue"},"insert":"\n"},{"insert":"</script>"},{"attributes":{"code-block":"vue"},"insert":"\n\n"},{"insert":"\n控制弹窗的显示与隐藏"},{"attributes":{"header":2},"insert":"\n"},{"insert":"   - 通过传递 `dialog-show` prop 控制弹窗显示状态。\n   - 监听 `@update:dialog-show` 事件以同步更新父组件中的状态（`.sync` 修饰符的替代写法）。\n\n使用 log-version-mixin 自动控制弹窗（自动检测 Cookie 并弹窗）"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n如果不想手动控制弹窗显示，而是希望组件自动根据用户是否看过日志来决定是否弹出，可以在任意 Vue 组件中**混入（mixin）** `log-version-mixin.js`：\n"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"import logVersionMixin from './log-version-mixin.js';"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"export default {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  mixins: [logVersionMixin],"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  mounted() {"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // mixin 内部会在 mounted 时自动调用 handleSetVersionLog()"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // 若用户未关闭过日志弹窗（即 Cookie SHOW_VERSION_LOG 为 'True'），则自动设置 logShow = true"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"    // 开发者可基于 logShow 做进一步操作，比如手动控制一个弹窗"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"  },"},{"attributes":{"code-block":"javascript"},"insert":"\n"},{"insert":"};"},{"attributes":{"code-block":"javascript"},"insert":"\n\n"},{"insert":"\n> 注意：当前 `log-version-mixin.js` 设置了 `logShow` 数据属性，但并未直接控制 `log-version.vue` 弹窗的显示。如需完全自动化，还需结合 `log-version.vue` 的 `dialogShow` prop 进行联动（比如在 mixin 中触发父组件设置 `dialogShow=true`）。目前看来，mixin 更多是提供“是否展示过日志”的状态，具体弹窗控制仍需由使用方（如父组件）完成。\n\nTypeScript / TSX 环境下使用（通过 intex.ts）"},{"attributes":{"header":1},"insert":"\n"},{"insert":"如果你在使用 TypeScript 或 TSX，可以通过 `intex.ts` 导出的已封装类型安全的组件来使用：\n"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"import LogVersionFromTsx from './intex.ts';"},{"attributes":{"code-block":"tsx"},"insert":"\n\n"},{"insert":"// 在 TSX 中使用"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"const App = () => {"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  const [showDialog, setShowDialog] = useState(false);"},{"attributes":{"code-block":"tsx"},"insert":"\n\n"},{"insert":"  return ("},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"    <>"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"      <button onClick={() => setShowDialog(true)}>查看版本日志</button>"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"      <LogVersionFromTsx dialogShow={showDialog} dialogShow={showDialog} onDialogShowUpdate={setShowDialog} />"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"    </>"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  );"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"};"},{"attributes":{"code-block":"tsx"},"insert":"\n\n"},{"insert":"\n> 注：`intex.ts` 利用了 `vue-tsx-support` 提供的 `ofType` 方法，对 `log-version.vue` 组件进行了 TS 类型封装，使得在 TSX 或严格类型检查的环境下能更好地推断 `dialogShow` prop 的类型。\n\n文件职责"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n| 文件 | 职责 |\n|------|------|\n| **intex.ts** | 对 `log-version.vue` 进行 TypeScript + TSX 类型封装，定义并导出带有类型检查的 Vue 组件，接收 `dialogShow` 控制弹窗显示与否。 |\n| **log-version-mixin.js** | Vue.js Mixin，提供自动检测用户是否看过版本日志的逻辑（通过 Cookie），在组件 mounted 时自动判断，设置 `logShow` 状态，可用于辅助控制是否弹出日志窗口。 |\n| **log-version.vue** | 主要的版本日志弹窗组件，包含完整的 UI 与交互逻辑：左侧版本列表、右侧详情、加载状态、版本切换、数据请求、弹窗显示控制、Cookie 管理等。 |\n"}],"extra":{"updator":"Austin","update_at":"2026-01-21 16:02:08"}}