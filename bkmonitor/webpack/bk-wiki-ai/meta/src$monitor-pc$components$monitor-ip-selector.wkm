{"ops":[{"insert":"这是一个 IP 选择器组件，主要用于在监控系统中选择和管理不同类型的 IP 或节点（如主机、服务模板、拓扑节点等）。下面从基本用途、主要功能和使用方法三个方面进行说明：\n\n基本用途"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n该组件是一个**高度可配置的 IP/节点选择控件**，通常用于**监控平台或运维系统中**，让用户能够以可视化的方式从不同的数据源（比如静态拓扑、动态拓扑、服务模板、主机列表、动态分组等）中选择目标 IP 或节点，并支持将这些选择结果以结构化数据形式输出，供后续逻辑处理或展示。\n\n它封装了来自 `@blueking/ip-selector` 的第三方 IP 选择器，并在其基础上进行了大量业务逻辑扩展和定制，以满足复杂业务场景下的需求，比如蓝鲸监控平台。\n\n主要功能"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n1. 支持多种选择模式和数据源面板"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 提供多种“面板”供用户选择数据，例如：\n  - 静态拓扑（staticTopo）\n  - 动态拓扑（dynamicTopo）\n  - 服务模板（serviceTemplate）\n  - 集合模板（setTemplate）\n  - 手动输入（manualInput）\n  - 动态分组（dynamicGroup）\n- 可通过 props 自定义启用的面板列表，控制用户可选择的数据范围。\n\n2. 支持多种选择类型和输出格式"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 支持 **“对话框模式”（dialog）** 和 **“区域模式”（section）**。\n- 支持输出不同格式的选中数据，包括主机列表、节点列表、服务模板、动态分组等。\n- 支持自定义字段展示、表格列配置、菜单扩展等 UI 相关功能。\n\n3. 强大的配置与扩展能力"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 允许注入自定义服务方法，覆盖默认的 API 请求逻辑，比如获取拓扑节点、查询服务实例、获取动态分组等。\n- 支持自定义主机表格列、节点表格列、服务模板表格列等。\n- 支持对选中数据的格式转换（比如将内部格式转为前端展示格式，或缓存映射转换）。\n- 支持只读模式、禁用提交/选择方法等控制。\n\n4. 数据转换与适配"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 内部实现了大量类型转换函数，用于：\n  - 将用户选择的值转换为后端需要的格式（transformValueToMonitor）\n  - 将后端返回的数据转换为组件可用的格式（transformMonitorToValue）\n  - 缓存与原始数据之间的转换（transformCacheMapToOriginData / transformOriginDataToCacheMap）\n\n5. 与 Vuex 等状态管理集成"},{"attributes":{"header":2},"insert":"\n"},{"insert":"- 自动获取当前业务的 bizId 等信息，用于构造请求参数。\n- 通过 Vue 组件生命周期初始化配置和数据服务。\n\n使用方法"},{"attributes":{"header":1},"insert":"\n"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"import MonitorIpSelector from './monitor-ip-selector';"},{"attributes":{"code-block":"tsx"},"insert":"\n\n"},{"insert":"// 在父组件中使用"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"<MonitorIpSelector"},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  v-model:value=\"selectedIps\""},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  :mode=\"'dialog'\""},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  :panel-list=\"['staticTopo', 'serviceTemplate']\""},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  :show-dialog=\"true\""},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"  @change=\"onIpChange\""},{"attributes":{"code-block":"tsx"},"insert":"\n"},{"insert":"/>"},{"attributes":{"code-block":"tsx"},"insert":"\n\n"},{"insert":"\n主要 Props（配置项）"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n| 参数名 | 类型 | 说明 |\n|--------|------|------|\n| value | IIpV6Value | 当前选中的值（支持 v-model） |\n| mode | 'dialog' \\| 'section' | 选择器模式：弹窗还是内联 |\n| panelList | string[] | 启用的选择面板，如 staticTopo、dynamicTopo、serviceTemplate 等 |\n| readonly | boolean | 是否只读 |\n| showView / showDialog | boolean | 是否展示预览或弹窗 |\n| hostTableCustomColumnList | IpSelectorHostTableCustomColumn[] | 自定义主机表格列 |\n| outputFieldList | string[] | 输出字段列表 |\n| nameStyle | 'camelCase' \\| 'kebabCase' | 字段命名风格 |\n| countInstanceType | 'host' \\| 'service_instance' | 计数实例类型 |\n| service | IpSelectorService | 自定义服务方法，可覆盖默认 API 行为 |\n\n主要事件"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n| 事件名 | 参数 | 说明 |\n|--------|------|------|\n| onChange | (value: Record<string, INode[]>) | 选择内容发生变化时触发，返回选中的节点数据 |\n| onCloseDialog | (isOpen: boolean) | 弹窗关闭时触发 |\n| onOutputFieldChange | (fields: string[]) | 输出字段发生变化时触发 |\n| onTargetTypeChange | (type: INodeType) | 选择的面板类型变化时触发 |\n\n数据格式说明"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n- 选中值的类型为 `IIpV6Value`，是一个复合对象，可能包含以下字段：\n  - host_list：选中的主机列表\n  - node_list：选中的拓扑节点列表\n  - service_template_list：选中的服务模板\n  - set_template_list：选中的集合模板\n  - dynamic_group_list：选中的动态分组\n\n- 所有通信与数据转换都基于 TypeScript 类型定义，确保类型安全，相关类型定义主要在 `typing.ts` 中。\n\n工具函数（utils.ts）"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n- 提供了一系列工具函数用于节点类型映射、数据格式转换、面板列表过滤等。\n- 比如：`toSelectorNode` 用于将目标对象转为选择器需要的节点格式；`transformValueToMonitor` 用于将选中的值转为后端格式。\n\n项目结构与依赖说明"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n| 文件 | 作用 |\n|------|------|\n| monitor-ip-selector.tsx | 核心 Vue 组件，封装了 IP 选择器的所有业务逻辑与 UI 展示 |\n| monitor-ip-selector.scss | 组件样式文件，目前仅定义了简单的布局样式 |\n| typing.ts | 定义了所有用到的 TypeScript 类型，包括参数、返回值、节点、主机等数据结构 |\n| utils.ts | 工具函数集，用于数据转换、参数处理、面板过滤等辅助功能 |\n| @blueking/ip-selector | 第三方 IP 选择器库，该组件基于它进行二次封装 |\n\n总结"},{"attributes":{"header":1},"insert":"\n"},{"insert":"\n这个 IP 选择器组件是一个**面向监控系统/运维平台的高度定制化、多数据源支持、可配置性极强的选择控件**，它：\n\n- 基于成熟的第三方库进行二次开发，保证功能稳定；\n- 通过丰富的 Props 和 Events 提供灵活的使用方式；\n- 通过 TypeScript 提供完整的类型支持，便于维护和扩展；\n- 支持多种业务场景，如主机选择、服务模板选择、拓扑节点选取等；\n- 适合在蓝鲸等大型运维平台中作为基础组件复用。\n\n如需使用，只需要传入相应的配置（如选择模式、面板、类型等），即可快速实现一个功能强大且可扩展的 IP/节点选择器。\n"}],"extra":{"updator":"Austin","update_at":"2026-01-21 16:24:48"}}