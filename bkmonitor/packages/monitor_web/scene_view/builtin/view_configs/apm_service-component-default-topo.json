{
  "id": "topo",
  "type": "topo",
  "mode": "custom",
  "name": "拓扑",
  "variables": [],
  "panels": [],
  "overview_panels": [
    {
      "id": 1,
      "title": "Clusters",
      "type": "apm-relation-graph",
      "instant": true,
      "targets": [
        {
          "datasource": "topo",
          "dataType": "topo",
          "api": "apm_topo.topoView",
          "data": {
            "app_name": "$app_name",
            "service_name": "$service_name",
            "data_type": "$data_type",
            "edge_data_type": "$edge_data_type",
            "export_type": "$export_type"
          }
        }
      ],
      "options": {
        "apm_relation_graph": {
          "service_detail": {
            "name": "服务概览",
            "type": "info",
            "targets": [
              {
                "datasource": "info",
                "dataType": "info",
                "api": "apm_meta.serviceDetail",
                "data": {
                  "app_name": "$app_name",
                  "service_name": "$service_name",
                  "start_time": "${start_time}",
                  "end_time": "${end_time}"
                }
              }
            ]
          },
          "service_alert": {
            "name": "告警",
            "type": "alert",
            "targets": [
              {
                "datasource": "alert",
                "dataType": "alert",
                "api": "apm_topo.dataTypeBarQuery",
                "data": {
                  "app_name": "$app_name",
                  "service_name": "$service_name",
                  "data_type": "alert"
                }
              }
            ],
            "descrition": "根据告警事件的数量进行划分，划分范围为：<br>1.红：发生了致命告警<br>2.黄：发生了预警<br>3.蓝：发生了提醒<br>4.绿：无告警",
            "options": {
              "time_series": {
                "hoverAllTooltips": true
              }
            }
          },
          "service_tabs_service": {
            "name": "服务",
            "type": "tab",
            "panels": [
              {
                "id": 1,
                "title": "Apdex",
                "type": "apdex-chart",
                "targets": [
                  {
                    "datasource": "apdex",
                    "dataType": "apdex",
                    "api": "apm_topo.dataTypeBarQuery",
                    "alias": "Apdex",
                    "data": {
                      "app_name": "$app_name",
                      "service_name": "$service_name",
                      "data_type": "apdex"
                    }
                  }
                ],
                "options": {
                  "time_series": {
                    "hoverAllTooltips": true
                  }
                }
              },
              {
                "id": 2,
                "title": "请求数",
                "type": "apm-timeseries-chart",
                "alias": "请求数",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "data": {
                      "alias_prefix": "caller",
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "3"
                              ]
                            },
                            {
                              "condition": "or",
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "4"
                              ]
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": []
                        }
                      ],
                      "stack": "all",
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "3"
                                ]
                              },
                              {
                                "condition": "or",
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "4"
                                ]
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "data": {
                      "alias_prefix": "callee",
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "2"
                              ]
                            },
                            {
                              "condition": "or",
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "5"
                              ]
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": []
                        }
                      ],
                      "stack": "all",
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "2"
                                ]
                              },
                              {
                                "condition": "or",
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "5"
                                ]
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  }
                ],
                "options": {
                  "time_series": {
                    "type": "bar",
                    "hoverAllTooltips": true
                  },
                  "apm_time_series": {
                    "metric": "request_count"
                  }
                }
              },
              {
                "id": 3,
                "title": "错误数",
                "type": "apm-timeseries-chart",
                "alias": "错误数",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "错误数",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "status_code",
                              "method": "eq",
                              "value": [
                                "2"
                              ],
                              "condition": "and"
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "$service_name"
                          },
                          "functions": []
                        }
                      ],
                      "unify_query_param": {
                        "type": "range",
                        "stack": "all",
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "status_code",
                                "method": "eq",
                                "value": [
                                  "2"
                                ],
                                "condition": "and"
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "$service_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    },
                    "yAxisIndex": 0,
                    "chart_type": "bar"
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "错误率",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "percentunit",
                      "expression": "b / c",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "b"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [
                            {
                              "key": "status_code",
                              "method": "eq",
                              "value": [
                                "2"
                              ],
                              "condition": "and"
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "$service_name"
                          },
                          "functions": []
                        },
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "c"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": null,
                          "filter_dict": {
                            "service_name": "$service_name"
                          },
                          "functions": []
                        }
                      ],
                      "unify_query_param": {
                        "expression": "b / c",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "b"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [
                              {
                                "key": "status_code",
                                "method": "eq",
                                "value": [
                                  "2"
                                ],
                                "condition": "and"
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "$service_name"
                            },
                            "functions": []
                          },
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "c"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": null,
                            "filter_dict": {
                              "service_name": "$service_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    },
                    "yAxisIndex": 1,
                    "chart_type": "line"
                  }
                ],
                "options": {
                  "time_series": {
                    "type": "bar",
                    "hoverAllTooltips": true
                  },
                  "apm_time_series": {
                    "metric": "error"
                  }
                }
              },
              {
                "id": 4,
                "title": "耗时",
                "type": "apm-timeseries-chart",
                "alias": "耗时",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "AVG",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "a / b",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_sum",
                              "method": "SUM",
                              "alias": "a"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": [
                            {
                              "id": "increase",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_total",
                              "method": "SUM",
                              "alias": "b"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": null,
                          "filter_dict": {},
                          "functions": [
                            {
                              "id": "increase",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "a / b",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_sum",
                                "method": "SUM",
                                "alias": "a"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": [
                              {
                                "id": "increase",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_total",
                                "method": "SUM",
                                "alias": "b"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": null,
                            "filter_dict": {},
                            "functions": [
                              {
                                "id": "increase",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P50",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.5
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.5
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P95",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.95
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.95
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P99",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.99
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.99
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  }
                ],
                "options": {
                  "apm_time_series": {
                    "metric": "duration"
                  },
                  "time_series": {
                    "hoverAllTooltips": true
                  }
                }
              }
            ]
          },
          "service_tabs_log": {
            "name": "日志",
            "type": "tab",
            "panels": [
              {
                "id": 1,
                "type": "related-log-chart",
                "targets": [
                  {
                    "dataType": "log_predicate",
                    "api": "apm_log.serviceLogInfo",
                    "data": {
                      "app_name": "${app_name}",
                      "bk_biz_id": "${bk_biz_id}",
                      "service_name": "${service_name}"
                    }
                  },
                  {
                    "dataType": "condition",
                    "api": "apm_log.serviceRelationList",
                    "data": {
                      "app_name": "${app_name}",
                      "bk_biz_id": "${bk_biz_id}",
                      "service_name": "${service_name}"
                    }
                  },
                  {
                    "dataType": "time_series",
                    "api": "scene_view.getIndexSetLogSeries",
                    "datasource": "time_series",
                    "alias": "总趋势",
                    "data": {
                      "bk_biz_id": "${bk_biz_id}",
                      "index_set_id": "${index_set_id}",
                      "start_time": "${start_time}",
                      "end_time": "${end_time}"
                    }
                  }
                ]
              }
            ]
          },
          "endpoint_detail": {
            "name": "接口概览",
            "type": "info",
            "targets": [
              {
                "datasource": "info",
                "dataType": "info",
                "api": "apm_meta.endpointDetail",
                "data": {
                  "app_name": "$app_name",
                  "service_name": "$service_name",
                  "endpoint_name": "$endpoint_name"
                }
              }
            ]
          },
          "endpoint_alert": {
            "name": "告警",
            "type": "alert",
            "targets": [
              {
                "datasource": "alert",
                "dataType": "alert",
                "api": "apm_topo.dataTypeBarQuery",
                "data": {
                  "app_name": "$app_name",
                  "service_name": "$service_name",
                  "data_type": "alert",
                  "endpoint_name": "$endpoint_name"
                }
              }
            ],
            "options": {
              "time_series": {
                "hoverAllTooltips": true
              }
            }
          },
          "endpoint_tabs_service": {
            "name": "服务",
            "type": "tab",
            "panels": [
              {
                "id": 1,
                "title": "Apdex",
                "type": "apdex-chart",
                "targets": [
                  {
                    "datasource": "apdex",
                    "dataType": "apdex",
                    "api": "apm_topo.dataTypeBarQuery",
                    "alias": "Apdex",
                    "data": {
                      "app_name": "$app_name",
                      "service_name": "$service_name",
                      "data_type": "apdex",
                      "endpoint_name": "$endpoint_name"
                    }
                  }
                ],
                "options": {
                  "time_series": {
                    "hoverAllTooltips": true
                  }
                }
              },
              {
                "id": 2,
                "title": "请求数",
                "type": "apm-timeseries-chart",
                "alias": "请求数",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "data": {
                      "alias_prefix": "caller",
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "3"
                              ]
                            },
                            {
                              "condition": "or",
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "4"
                              ]
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": []
                        }
                      ],
                      "stack": "all",
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "3"
                                ]
                              },
                              {
                                "condition": "or",
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "4"
                                ]
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "data": {
                      "alias_prefix": "callee",
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "2"
                              ]
                            },
                            {
                              "condition": "or",
                              "key": "kind",
                              "method": "eq",
                              "value": [
                                "5"
                              ]
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": []
                        }
                      ],
                      "stack": "all",
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "2"
                                ]
                              },
                              {
                                "condition": "or",
                                "key": "kind",
                                "method": "eq",
                                "value": [
                                  "5"
                                ]
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  }
                ],
                "options": {
                  "time_series": {
                    "type": "bar",
                    "hoverAllTooltips": true
                  },
                  "apm_time_series": {
                    "metric": "request_count"
                  }
                }
              },
              {
                "id": 3,
                "title": "错误数",
                "type": "apm-timeseries-chart",
                "alias": "错误数",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "错误数",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                          ],
                          "display": true,
                          "where": [
                            {
                              "key": "status_code",
                              "method": "eq",
                              "value": [
                                "2"
                              ],
                              "condition": "and"
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "$service_name",
                            "span_name": "$endpoint_name"
                          },
                          "functions": []
                        }
                      ],
                      "unify_query_param": {
                        "type": "range",
                        "stack": "all",
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                            ],
                            "display": true,
                            "where": [
                              {
                                "key": "status_code",
                                "method": "eq",
                                "value": [
                                  "2"
                                ],
                                "condition": "and"
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "$service_name",
                              "span_name": "$endpoint_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    },
                    "yAxisIndex": 0,
                    "chart_type": "bar"
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "错误率",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "percentunit",
                      "expression": "b / c",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "b"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [
                            {
                              "key": "status_code",
                              "method": "eq",
                              "value": [
                                "2"
                              ],
                              "condition": "and"
                            }
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "$service_name",
                            "span_name": "$endpoint_name"
                          },
                          "functions": []
                        },
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_count",
                              "method": "SUM",
                              "alias": "c"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": null,
                          "filter_dict": {
                            "service_name": "$service_name",
                            "span_name": "$endpoint_name"
                          },
                          "functions": []
                        }
                      ],
                      "unify_query_param": {
                        "expression": "b / c",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "b"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [
                              {
                                "key": "status_code",
                                "method": "eq",
                                "value": [
                                  "2"
                                ],
                                "condition": "and"
                              }
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "$service_name",
                              "span_name": "$endpoint_name"
                            },
                            "functions": []
                          },
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_count",
                                "method": "SUM",
                                "alias": "c"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": null,
                            "filter_dict": {
                              "service_name": "$service_name",
                              "span_name": "$endpoint_name"
                            },
                            "functions": []
                          }
                        ]
                      },
                      "fill_bar": true
                    },
                    "yAxisIndex": 1,
                    "chart_type": "line"
                  }
                ],
                "options": {
                  "time_series": {
                    "type": "bar",
                    "hoverAllTooltips": true
                  },
                  "apm_time_series": {
                    "metric": "error"
                  }
                }
              },
              {
                "id": 4,
                "title": "耗时",
                "type": "apm-timeseries-chart",
                "alias": "耗时",
                "targets": [
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "AVG",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "a / b",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_sum",
                              "method": "SUM",
                              "alias": "a"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": [
                            {
                              "id": "increase",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "metrics": [
                            {
                              "field": "bk_apm_total",
                              "method": "SUM",
                              "alias": "b"
                            }
                          ],
                          "table": "${table_id}",
                          "data_label": "",
                          "index_set_id": null,
                          "group_by": [],
                          "where": [],
                          "interval_unit": "s",
                          "time_field": null,
                          "filter_dict": {},
                          "functions": [
                            {
                              "id": "increase",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "a / b",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_sum",
                                "method": "SUM",
                                "alias": "a"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": [
                              {
                                "id": "increase",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "metrics": [
                              {
                                "field": "bk_apm_total",
                                "method": "SUM",
                                "alias": "b"
                              }
                            ],
                            "table": "${table_id}",
                            "data_label": "",
                            "index_set_id": null,
                            "group_by": [],
                            "where": [],
                            "interval_unit": "s",
                            "time_field": null,
                            "filter_dict": {},
                            "functions": [
                              {
                                "id": "increase",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P50",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.5
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.5
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P95",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.95
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.95
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  },
                  {
                    "data_type": "time_series",
                    "api": "apm_metric.dynamicUnifyQuery",
                    "datasource": "time_series",
                    "alias": "P99",
                    "data": {
                      "app_name": "${app_name}",
                      "service_name": "${service_name}",
                      "unit": "ns",
                      "expression": "A",
                      "query_configs": [
                        {
                          "data_source_label": "custom",
                          "data_type_label": "time_series",
                          "table": "${table_id}",
                          "metrics": [
                            {
                              "field": "bk_apm_duration_bucket",
                              "method": "SUM",
                              "alias": "A"
                            }
                          ],
                          "group_by": [
                            "le"
                          ],
                          "display": true,
                          "where": [
                          ],
                          "interval_unit": "s",
                          "time_field": "time",
                          "filter_dict": {
                            "service_name": "${service_name}",
                            "span_name": "$endpoint_name"
                          },
                          "functions": [
                            {
                              "id": "rate",
                              "params": [
                                {
                                  "id": "window",
                                  "value": "2m"
                                }
                              ]
                            },
                            {
                              "id": "histogram_quantile",
                              "params": [
                                {
                                  "id": "scalar",
                                  "value": 0.99
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "unify_query_param": {
                        "expression": "A",
                        "query_configs": [
                          {
                            "data_source_label": "custom",
                            "data_type_label": "time_series",
                            "table": "${table_id}",
                            "metrics": [
                              {
                                "field": "bk_apm_duration_bucket",
                                "method": "SUM",
                                "alias": "A"
                              }
                            ],
                            "group_by": [
                              "le"
                            ],
                            "display": true,
                            "where": [
                            ],
                            "interval_unit": "s",
                            "time_field": "time",
                            "filter_dict": {
                              "service_name": "${service_name}",
                              "span_name": "$endpoint_name"
                            },
                            "functions": [
                              {
                                "id": "rate",
                                "params": [
                                  {
                                    "id": "window",
                                    "value": "2m"
                                  }
                                ]
                              },
                              {
                                "id": "histogram_quantile",
                                "params": [
                                  {
                                    "id": "scalar",
                                    "value": 0.99
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "fill_bar": true
                    }
                  }
                ],
                "options": {
                  "apm_time_series": {
                    "metric": "duration"
                  },
                  "time_series": {
                    "hoverAllTooltips": true
                  }
                }
              }
            ]
          }
        }
      },
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 24,
        "h": 24
      }
    }
  ],
  "order": [],
  "options": {}
}
