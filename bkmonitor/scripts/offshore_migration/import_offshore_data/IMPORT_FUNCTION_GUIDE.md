# ç›‘æ§é…ç½®å¯¼å…¥åŠŸèƒ½å®Œæ•´å­¦ä¹ æ–‡æ¡£

## ğŸ“š ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
5. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
6. [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
7. [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
9. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
10. [é™„å½•](#é™„å½•)

---

## åŠŸèƒ½æ¦‚è¿°

### 1.1 èƒŒæ™¯

ç›‘æ§é…ç½®å¯¼å…¥åŠŸèƒ½æ˜¯ä¸ºäº†æ”¯æŒè“é²¸ç›‘æ§å¹³å°çš„**è·¨ç¯å¢ƒæ•°æ®è¿ç§»**éœ€æ±‚è€Œå¼€å‘çš„ã€‚ä¸å¯¼å‡ºåŠŸèƒ½é…å¥—ä½¿ç”¨ï¼Œå½“éœ€è¦å°†é…ç½®æ•°æ®ï¼ˆå¦‚å‘Šè­¦ç­–ç•¥ã€ä»ªè¡¨ç›˜ã€é‡‡é›†é…ç½®ç­‰ï¼‰ä»æºç¯å¢ƒè¿ç§»åˆ°ç›®æ ‡ç¯å¢ƒæ—¶ï¼Œå¯¼å…¥åŠŸèƒ½è´Ÿè´£è¯»å–å¯¼å‡ºæ–‡ä»¶å¹¶åœ¨ç›®æ ‡ç¯å¢ƒä¸­é‡å»ºè¿™äº›é…ç½®ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

- âœ… **å¤šèµ„æºç±»å‹å¯¼å…¥**ï¼šæ”¯æŒ 12 ç§èµ„æºç±»å‹çš„å¯¼å…¥
- âœ… **æ•°æ®é€‚é…è½¬æ¢**ï¼šè‡ªåŠ¨å¤„ç†æ—¶é—´æˆ³ã€ä¸šåŠ¡IDã€ç”¨æˆ·ä¿¡æ¯ç­‰ç¯å¢ƒå·®å¼‚
- âœ… **å…³ç³»æ•°æ®å¯¼å…¥**ï¼šè‡ªåŠ¨å¯¼å…¥å…³è”çš„ä¾èµ–æ•°æ®ï¼ˆå¦‚ç­–ç•¥çš„æ£€æµ‹é¡¹ã€ç®—æ³•ç­‰ï¼‰
- âœ… **ID æ˜ å°„ç®¡ç†**ï¼šç»´æŠ¤åŸå§‹IDåˆ°æ–°IDçš„æ˜ å°„ï¼Œç¡®ä¿å…³è”å…³ç³»æ­£ç¡®é‡å»º
- âœ… **å†²çªå¤„ç†**ï¼šæ”¯æŒè·³è¿‡ã€è¦†ç›–ã€é‡å‘½åä¸‰ç§å†²çªå¤„ç†ç­–ç•¥
- âœ… **å¤–é”®è§£æ**ï¼šè‡ªåŠ¨å°†å¯¼å‡ºæ•°æ®ä¸­çš„åŸå§‹å¤–é”®IDè½¬æ¢ä¸ºæ–°ç¯å¢ƒçš„ID
- âœ… **äº‹åŠ¡æ”¯æŒ**ï¼šå¯¼å…¥è¿‡ç¨‹åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 1.3 æ”¯æŒçš„èµ„æºç±»å‹

| èµ„æºç±»å‹ | è¯´æ˜ | å…³è”æ•°æ® | æ¨¡å‹ç±» |
|---------|------|---------|--------|
| `strategy` | å‘Šè­¦ç­–ç•¥ | Itemã€Detectã€Algorithm | `StrategyModel` |
| `user_group` | å‘Šè­¦ç»„ | DutyArrangeã€DutyRule | `UserGroup` |
| `duty_rule` | è½®å€¼è§„åˆ™ | - | `DutyRule` |
| `action_config` | å¤„ç†å¥—é¤ | - | `ActionConfig` |
| `action_plugin` | å“åº”åŠ¨ä½œæ’ä»¶ | - | `ActionPlugin` |
| `alert_assign_group` | å‘Šè­¦åˆ†æ´¾ç»„ | AlertAssignRule | `AlertAssignGroup` |
| `shield` | å‘Šè­¦å±è”½ | - | `Shield` |
| `dashboard` | ä»ªè¡¨ç›˜ | - | `Dashboard` |
| `collect_config` | æ•°æ®é‡‡é›†é…ç½® | CollectorPlugin | `CollectConfigMeta` |
| `collector_plugin` | é‡‡é›†æ’ä»¶ | - | `CollectorPluginMeta` |
| `custom_ts_table` | è‡ªå®šä¹‰æ—¶åºè¡¨ | CustomTSField | `CustomTSTable` |
| `custom_ts_group` | è‡ªå®šä¹‰æ—¶åºåˆ†ç»„ | - | `TimeSeriesGroup` |

---

## æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ConfigImporter                       â”‚
â”‚              (ä¸»å¯¼å…¥æ§åˆ¶å™¨)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ImportAdapterMgrâ”‚   â”‚ ImportIDMapper  â”‚
â”‚ (é€‚é…å™¨ç®¡ç†)    â”‚   â”‚  (IDæ˜ å°„ç®¡ç†)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                    â”‚
â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TimestampImport  â”‚  â”‚BizIDImport   â”‚  â”‚UserInfoImport   â”‚
â”‚Adapter          â”‚  â”‚Adapter       â”‚  â”‚Adapter          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  BaseImporter   â”‚
         â”‚  (åŸºç¡€å¯¼å…¥å™¨)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Strategyâ”‚  â”‚Dashboard  â”‚  â”‚Collect â”‚
â”‚Importerâ”‚  â”‚Importer   â”‚  â”‚Importerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸å¯¼å‡ºåŠŸèƒ½çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     å¯¼å‡ºæ–‡ä»¶      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æºç¯å¢ƒ      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•> â”‚  ç›®æ ‡ç¯å¢ƒ    â”‚
â”‚             â”‚  (JSONæ ¼å¼)       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                 â”‚
      â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ConfigExporterâ”‚                   â”‚ConfigImporterâ”‚
â”‚  (å¯¼å‡ºå™¨)     â”‚                   â”‚  (å¯¼å…¥å™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                 â”‚
      â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®é€‚é…å™¨   â”‚                   â”‚ æ•°æ®é€‚é…å™¨   â”‚
â”‚ (export)    â”‚                   â”‚ (import)    â”‚
â”‚ - datetimeâ†’tsâ”‚                   â”‚ - tsâ†’datetimeâ”‚
â”‚ - åŸŸåæ›¿æ¢   â”‚                   â”‚ - ä¸šåŠ¡IDæ˜ å°„ â”‚
â”‚ - ç”¨æˆ·å¤„ç†   â”‚                   â”‚ - ç”¨æˆ·å¤„ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
2. **é€‚é…å™¨æ¨¡å¼**ï¼šé€šè¿‡é€‚é…å™¨å¤„ç†ç¯å¢ƒå·®å¼‚ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
3. **å¯é…ç½®æ€§**ï¼šæ‰€æœ‰è¡Œä¸ºé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
4. **ä¾èµ–ç®¡ç†**ï¼šæŒ‰ç…§ä¾èµ–é¡ºåºå¯¼å…¥èµ„æºï¼Œç¡®ä¿å¤–é”®å…³ç³»æ­£ç¡®
5. **æ•°æ®å®Œæ•´æ€§**ï¼šé€šè¿‡äº‹åŠ¡ç¡®ä¿å¯¼å…¥æ•°æ®çš„ä¸€è‡´æ€§
6. **IDæ˜ å°„**ï¼šç»´æŠ¤åŸå§‹IDåˆ°æ–°IDçš„æ˜ å°„ï¼Œç¡®ä¿å…³è”å…³ç³»æ­£ç¡®é‡å»º

### 2.4 æ ¸å¿ƒè®¾è®¡æ¨¡å¼

- **é€‚é…å™¨æ¨¡å¼**ï¼š`ImportAdapterManager` + å„ç§ `ImportAdapter`
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒçš„å¯¼å…¥å™¨å®ç°ä¸åŒçš„å¯¼å…¥ç­–ç•¥ï¼ˆå†²çªå¤„ç†ï¼‰
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼š`BaseImporter` å®šä¹‰å¯¼å…¥æµç¨‹ï¼Œå­ç±»å®ç°å…·ä½“é€»è¾‘
- **å·¥å‚æ¨¡å¼**ï¼š`IMPORTER_REGISTRY` æ³¨å†Œå’Œç®¡ç†å¯¼å…¥å™¨
- **æ··å…¥æ¨¡å¼**ï¼š`RelationImportMixin` æä¾›å…³è”æ•°æ®å¯¼å…¥çš„é€šç”¨æ–¹æ³•

---

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 3.1 ConfigImporterï¼ˆä¸»å¯¼å…¥æ§åˆ¶å™¨ï¼‰

**ä½ç½®**ï¼š`import_config.py`

**èŒè´£**ï¼š
- åŠ è½½å’Œè§£æå¯¼å‡ºæ–‡ä»¶
- åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶
- åˆå§‹åŒ–é€‚é…å™¨ç®¡ç†å™¨å’ŒIDæ˜ å°„å™¨
- åè°ƒå„ä¸ªå¯¼å…¥å™¨çš„æ‰§è¡Œ
- ç”Ÿæˆå¯¼å…¥ç»“æœæ‘˜è¦

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```python
class ConfigImporter:
    def __init__(self, export_file: str, config_file: str = None, config_dict: dict = None)
    def import_all(self) -> dict
    def get_import_summary(self) -> dict
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
from scripts.offshore_migration.import_offshore_data.import_config import ConfigImporter

# æ–¹å¼1: ä½¿ç”¨é…ç½®æ–‡ä»¶
importer = ConfigImporter(
    export_file="export_data/monitor_config_export.json",
    config_file="import_config.yaml"
)

# æ–¹å¼2: ä½¿ç”¨é…ç½®å­—å…¸
config = {
    "import": {"resources": [], "conflict_strategy": "skip"},
    "adapters": {"biz_id_mapping": {"mapping": {"100": "200"}}}
}
importer = ConfigImporter(
    export_file="export_data/monitor_config_export.json",
    config_dict=config
)

# æ‰§è¡Œå¯¼å…¥
summary = importer.import_all()
print(f"å¯¼å…¥å®Œæˆ: æˆåŠŸ {summary['success']}, å¤±è´¥ {summary['failed']}")
```

### 3.2 BaseImporterï¼ˆåŸºç¡€å¯¼å…¥å™¨ï¼‰

**ä½ç½®**ï¼š`import_base.py`

**èŒè´£**ï¼š
- å®šä¹‰å¯¼å…¥å™¨çš„é€šç”¨æ¥å£å’Œæµç¨‹
- æä¾›å†²çªæ£€æµ‹å’Œå¤„ç†
- ç®¡ç†å¤–é”®è§£æ
- ç®¡ç†IDæ˜ å°„

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```python
class BaseImporter:
    def should_import(self) -> bool              # åˆ¤æ–­æ˜¯å¦éœ€è¦å¯¼å…¥æ­¤èµ„æº
    def import_all(self, resources_data) -> List # å¯¼å…¥æ‰€æœ‰èµ„æº
    def import_single(self, data) -> Model       # å¯¼å…¥å•ä¸ªå¯¹è±¡
    def import_relations(self, obj, relations)   # å¯¼å…¥å…³è”æ•°æ®
    
    # å†…éƒ¨æ–¹æ³•
    def _check_conflict(self, data) -> Optional[Model]     # æ£€æŸ¥å†²çª
    def _handle_conflict(self, data, existing) -> Model    # å¤„ç†å†²çª
    def _create_object(self, data) -> Model                # åˆ›å»ºå¯¹è±¡
    def _resolve_foreign_keys(self, data) -> dict          # è§£æå¤–é”®
```

**å¯¼å…¥æµç¨‹**ï¼š

```
1. should_import()         â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦å¯¼å…¥
2. apply_adapters()        â†’ åº”ç”¨å¯¼å…¥é€‚é…å™¨
3. _resolve_foreign_keys() â†’ è§£æå¤–é”®ï¼ˆåŸå§‹IDâ†’æ–°IDï¼‰
4. _check_conflict()       â†’ æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†²çª
5. _handle_conflict()      â†’ å¤„ç†å†²çªï¼ˆskip/overwrite/renameï¼‰
   æˆ– _create_object()     â†’ åˆ›å»ºæ–°å¯¹è±¡
6. add_mapping()           â†’ è®°å½•IDæ˜ å°„
7. import_relations()      â†’ å¯¼å…¥å…³è”æ•°æ®
```

### 3.3 ImportAdapterManagerï¼ˆé€‚é…å™¨ç®¡ç†å™¨ï¼‰

**ä½ç½®**ï¼š`import_adapters.py`

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰å¯¼å…¥é€‚é…å™¨çš„ç”Ÿå‘½å‘¨æœŸ
- æŒ‰é¡ºåºåº”ç”¨é€‚é…å™¨
- æ ¹æ®é…ç½®åŠ¨æ€å¯ç”¨/ç¦ç”¨é€‚é…å™¨

**é€‚é…å™¨æ‰§è¡Œé¡ºåº**ï¼š

```
1. TimestampImportAdapter  â†’ timestamp â†’ datetime
2. BizIDImportAdapter      â†’ å¤„ç†ä¸šåŠ¡IDæ˜ å°„ï¼ˆå¦‚æœé…ç½®ï¼‰
3. UserInfoImportAdapter   â†’ å¤„ç†ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœé…ç½®ï¼‰
4. DomainImportAdapter     â†’ å¤„ç†åŸŸåæ›¿æ¢ï¼ˆå¦‚æœé…ç½®ï¼‰
```

### 3.4 é€‚é…å™¨è¯¦è§£

#### 3.4.1 TimestampImportAdapterï¼ˆæ—¶é—´æˆ³é€‚é…å™¨ï¼‰

**ä½œç”¨**ï¼šå°† Unix æ—¶é—´æˆ³è½¬æ¢å› `datetime` å¯¹è±¡

**ç¤ºä¾‹**ï¼š
```python
# è½¬æ¢å‰ï¼ˆå¯¼å‡ºæ–‡ä»¶ä¸­çš„æ ¼å¼ï¼‰
{"create_time": 1737269400}

# è½¬æ¢åï¼ˆå¯¼å…¥æ—¶è½¬æ¢ï¼‰
{"create_time": datetime(2025, 1, 19, 12, 0, 0)}
```

**æ”¯æŒçš„æ—¶é—´æˆ³æ ¼å¼**ï¼š
- 10ä½æ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰ï¼š`1000000000` ~ `9999999999`
- 13ä½æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼‰ï¼š`1000000000000` ~ `9999999999999`

#### 3.4.2 BizIDImportAdapterï¼ˆä¸šåŠ¡IDé€‚é…å™¨ï¼‰

**ä½œç”¨**ï¼šå°†æºç¯å¢ƒçš„ä¸šåŠ¡IDæ˜ å°„åˆ°ç›®æ ‡ç¯å¢ƒçš„ä¸šåŠ¡ID

**é…ç½®**ï¼š
```yaml
biz_id_mapping:
  mapping:
    "100": "200"  # åŸä¸šåŠ¡ID 100 â†’ ç›®æ ‡ä¸šåŠ¡ID 200
    "101": "201"
```

**å¤„ç†é€»è¾‘**ï¼š
- æ£€æŸ¥æ•°æ®ä¸­æ˜¯å¦æœ‰ `_biz_id_mapping_required: true` æ ‡è®°
- å¦‚æœæœ‰ï¼Œåˆ™æ ¹æ® `mapping` é…ç½®æ›¿æ¢ `bk_biz_id` å­—æ®µ
- å¦‚æœæ‰¾ä¸åˆ°æ˜ å°„å…³ç³»ï¼ŒæŠ›å‡º `ValueError` å¼‚å¸¸

#### 3.4.3 UserInfoImportAdapterï¼ˆç”¨æˆ·ä¿¡æ¯é€‚é…å™¨ï¼‰

**ä½œç”¨**ï¼šå¤„ç†ç”¨æˆ·å­—æ®µï¼ˆcreate_user, update_user ç­‰ï¼‰

**ç­–ç•¥**ï¼š
- `keep`ï¼šä¿ç•™åŸå§‹ç”¨æˆ·ï¼ˆé»˜è®¤ï¼‰
- `replace`ï¼šæ›¿æ¢ä¸ºé»˜è®¤ç”¨æˆ·
- `remove`ï¼šæ¸…ç©ºç”¨æˆ·å­—æ®µ

**é…ç½®**ï¼š
```yaml
user_mapping:
  strategy: "replace"
  default_user: "admin"
```

**å¤„ç†çš„å­—æ®µ**ï¼š
- `create_user`
- `update_user`
- `created_by`
- `updated_by`

#### 3.4.4 DomainImportAdapterï¼ˆåŸŸåé€‚é…å™¨ï¼‰

**ä½œç”¨**ï¼šæ›¿æ¢åŸŸåï¼ˆé€šå¸¸å¯¼å…¥æ—¶ä¸éœ€è¦ï¼Œä¿ç•™ç”¨äºç‰¹æ®Šåœºæ™¯ï¼‰

**é…ç½®**ï¼š
```yaml
domain_mapping:
  "https://new-domain.com": "https://old-domain.com"
```

### 3.5 ImportIDMapperï¼ˆIDæ˜ å°„å™¨ï¼‰

**ä½ç½®**ï¼š`import_utils.py`

**ä½œç”¨**ï¼š
- ç»´æŠ¤åŸå§‹IDåˆ°æ–°IDçš„æ˜ å°„å…³ç³»
- ä¾¿äºå¯¼å…¥å…³è”æ•°æ®æ—¶è§£æå¤–é”®

**æ•°æ®ç»“æ„**ï¼š
```python
{
    "strategy": {
        "100": 1001,  # åŸå§‹ID 100 â†’ æ–°ID 1001
        "101": 1002
    },
    "user_group": {
        "200": 2001,
        "201": 2002
    }
}
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
class ImportIDMapper:
    def add_mapping(resource_type, original_id, new_id)  # æ·»åŠ æ˜ å°„
    def get_new_id(resource_type, original_id) -> Any    # è·å–æ–°ID
    def to_dict() -> dict                                # è½¬æ¢ä¸ºå­—å…¸
    def from_dict(data: dict)                            # ä»å­—å…¸åŠ è½½
```

### 3.6 RelationImportMixinï¼ˆå…³è”æ•°æ®å¯¼å…¥æ··å…¥ç±»ï¼‰

**ä½ç½®**ï¼š`import_base.py`

**ä½œç”¨**ï¼šæä¾›å¯¼å…¥å…³è” QuerySet æ•°æ®çš„é€šç”¨æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```python
class RelationImportMixin:
    def import_related_queryset(
        self, 
        obj: Model,                # ä¸»å¯¹è±¡
        relation_key: str,         # å…³è”é”®åï¼ˆç”¨äºæ—¥å¿—ï¼‰
        relation_data: List[dict], # å…³è”æ•°æ®åˆ—è¡¨
        model_class,               # å…³è”æ¨¡å‹ç±»
        foreign_key_field: str     # å¤–é”®å­—æ®µå
    )
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
class StrategyImporter(BaseImporter, RelationImportMixin):
    def import_relations(self, obj, relations: dict):
        # å¯¼å…¥å…³è”çš„æ£€æµ‹é¡¹
        if "items" in relations:
            self.import_related_queryset(
                obj, "items", relations["items"], Item, "strategy_id"
            )
```

### 3.7 å¯¼å…¥å™¨å®ç°

æ¯ä¸ªèµ„æºç±»å‹éƒ½æœ‰å¯¹åº”çš„å¯¼å…¥å™¨ï¼Œç»§æ‰¿è‡ª `BaseImporter`ï¼š

```python
class StrategyImporter(BaseImporter, RelationImportMixin):
    resource_type = "strategy"
    model_class = StrategyModel
    
    def import_relations(self, obj, relations: dict):
        # å¯¼å…¥å…³è”çš„ Itemã€Detectã€Algorithm
        if "items" in relations:
            self.import_related_queryset(obj, "items", relations["items"], Item, "strategy_id")
        if "detects" in relations:
            self.import_related_queryset(obj, "detects", relations["detects"], DetectModel, "strategy_id")
        if "algorithms" in relations:
            self.import_related_queryset(obj, "algorithms", relations["algorithms"], AlgorithmModel, "strategy_id")
```

---

## é…ç½®ç³»ç»Ÿ

### 4.1 é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# å¯¼å…¥é…ç½®
import:
  resources: []              # èµ„æºç±»å‹åˆ—è¡¨ï¼ˆç©ºåˆ—è¡¨=æ‰€æœ‰ï¼‰
  conflict_strategy: "skip"  # å†²çªå¤„ç†ç­–ç•¥
  validate: true             # æ˜¯å¦éªŒè¯å¯¼å…¥æ•°æ®

# é€‚é…å™¨é…ç½®
adapters:
  biz_id_mapping:            # ä¸šåŠ¡IDæ˜ å°„ï¼ˆå¿…éœ€ï¼‰
    mapping:
      "100": "200"
  user_mapping:              # ç”¨æˆ·ä¿¡æ¯å¤„ç†
    strategy: "keep"
    default_user: "admin"
  domain_mapping: {}         # åŸŸåå¤„ç†ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰
```

### 4.2 å†²çªå¤„ç†ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `skip` | è·³è¿‡å·²å­˜åœ¨çš„å¯¹è±¡ï¼ˆé»˜è®¤ï¼‰ | å¢é‡å¯¼å…¥ï¼Œé¿å…è¦†ç›–ç°æœ‰é…ç½® |
| `overwrite` | è¦†ç›–å·²å­˜åœ¨çš„å¯¹è±¡ | éœ€è¦æ›´æ–°ç°æœ‰é…ç½® |
| `rename` | é‡å‘½åæ–°å¯¹è±¡ï¼ˆæ·»åŠ åç¼€ï¼‰ | ä¿ç•™ä¸¤ä¸ªç‰ˆæœ¬çš„é…ç½® |

**å†²çªæ£€æµ‹é€»è¾‘**ï¼š

é»˜è®¤ä½¿ç”¨ `name` + `bk_biz_id` ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚ç‰¹å®šèµ„æºç±»å‹å¯ä»¥é‡å†™ `_check_conflict` æ–¹æ³•ï¼š

```python
# DashboardImporter: ä½¿ç”¨ org_id + name
def _check_conflict(self, data: dict):
    name = data.get("name")
    org_id = data.get("org_id")
    if name and org_id is not None:
        return self.model_class.objects.get(name=name, org_id=org_id)

# CollectorPluginImporter: ä½¿ç”¨ plugin_id + bk_tenant_id
def _check_conflict(self, data: dict):
    plugin_id = data.get("plugin_id")
    bk_tenant_id = data.get("bk_tenant_id")
    if plugin_id and bk_tenant_id:
        return self.model_class.objects.get(plugin_id=plugin_id, bk_tenant_id=bk_tenant_id)
```

### 4.3 è¯¦ç»†é…ç½®è¯´æ˜

å‚è€ƒ `import_config.example.yaml` æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- æ¯ä¸ªé…ç½®é¡¹çš„è¯¦ç»†è¯´æ˜
- å¤šç§ä½¿ç”¨åœºæ™¯çš„ç¤ºä¾‹
- å‚æ•°è¯´æ˜å’Œæ³¨æ„äº‹é¡¹

---

## ä½¿ç”¨æŒ‡å—

### 5.1 å¿«é€Ÿå¼€å§‹

#### æ–¹å¼1ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# åŸºæœ¬ç”¨æ³•
python scripts/offshore_migration/import_offshore_data/import_config.py \
    --export-file export_data/monitor_config_export.json

# ä½¿ç”¨é…ç½®æ–‡ä»¶
python scripts/offshore_migration/import_offshore_data/import_config.py \
    --export-file export_data/monitor_config_export.json \
    --config import_config.yaml
```

#### æ–¹å¼2ï¼šä½¿ç”¨ç¤ºä¾‹è„šæœ¬

```bash
cd /path/to/bkmonitor
python manage.py shell < scripts/offshore_migration/import_offshore_data/example_import_usage.py
```

#### æ–¹å¼3ï¼šåœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from scripts.offshore_migration.import_offshore_data.import_config import ConfigImporter

# åˆ›å»ºå¯¼å…¥å™¨
importer = ConfigImporter(
    export_file="export_data/monitor_config_export.json",
    config_file="import_config.yaml"
)

# æ‰§è¡Œå¯¼å…¥
summary = importer.import_all()
print(f"å¯¼å…¥å®Œæˆ: {summary}")
```

### 5.2 å…¸å‹ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šå¯¼å…¥æ‰€æœ‰èµ„æºï¼ˆä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼‰

```yaml
import:
  resources: []              # ç©ºåˆ—è¡¨ = æ‰€æœ‰èµ„æº
  conflict_strategy: "skip"  # è·³è¿‡å·²å­˜åœ¨çš„

adapters:
  biz_id_mapping:
    mapping:
      "100": "200"
```

#### åœºæ™¯2ï¼šå¯¼å…¥æŒ‡å®šèµ„æºç±»å‹

```yaml
import:
  resources: ["strategy", "user_group"]
  conflict_strategy: "skip"

adapters:
  biz_id_mapping:
    mapping:
      "100": "200"
```

#### åœºæ™¯3ï¼šè¦†ç›–å¯¼å…¥ï¼ˆæ›´æ–°ç°æœ‰é…ç½®ï¼‰

```yaml
import:
  resources: []
  conflict_strategy: "overwrite"

adapters:
  biz_id_mapping:
    mapping:
      "100": "200"
```

#### åœºæ™¯4ï¼šè·¨ç¯å¢ƒè¿ç§»ï¼ˆéœ€è¦æ›¿æ¢ç”¨æˆ·ï¼‰

```yaml
import:
  resources: []
  conflict_strategy: "skip"

adapters:
  biz_id_mapping:
    mapping:
      "100": "200"
      "101": "201"
  
  user_mapping:
    strategy: "replace"
    default_user: "admin"
```

### 5.3 å¯¼å…¥ç»“æœæ ¼å¼

```python
{
    "success": 150,      # æˆåŠŸå¯¼å…¥çš„å¯¹è±¡æ•°
    "failed": 2,         # å¯¼å…¥å¤±è´¥çš„å¯¹è±¡æ•°
    "skipped": 10,       # è·³è¿‡çš„å¯¹è±¡æ•°ï¼ˆå·²å­˜åœ¨ï¼‰
    "total": 162,        # æ€»å¯¹è±¡æ•°
    "id_mapping": {      # IDæ˜ å°„å…³ç³»
        "id_mapping": {
            "strategy": {"100": 1001, "101": 1002},
            "user_group": {"200": 2001}
        }
    }
}
```

---

## æ•°æ®æµç¨‹

### 6.1 å®Œæ•´å¯¼å…¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½å¯¼å‡ºæ–‡ä»¶                                          â”‚
â”‚    - è¯»å– JSON å¯¼å‡ºæ–‡ä»¶                                  â”‚
â”‚    - éªŒè¯æ–‡ä»¶æ ¼å¼ï¼ˆversion, export_time, resources, metadataï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åŠ è½½é…ç½®                                              â”‚
â”‚    - è¯»å– YAML/JSON é…ç½®æ–‡ä»¶                             â”‚
â”‚    - åˆå¹¶é»˜è®¤é…ç½®                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆå§‹åŒ–ç»„ä»¶                                            â”‚
â”‚    - ImportAdapterManager: åˆå§‹åŒ–é€‚é…å™¨                  â”‚
â”‚    - ImportIDMapper: åˆå§‹åŒ–IDæ˜ å°„å™¨                       â”‚
â”‚    - ä»å¯¼å‡ºæ–‡ä»¶çš„ metadata åˆå§‹åŒ–æ˜ å°„è¡¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æŒ‰ä¾èµ–é¡ºåºå¯¼å…¥èµ„æº                                     â”‚
â”‚    - æ ¹æ® EXPORT_ORDER ç¡®å®šå¯¼å…¥é¡ºåº                      â”‚
â”‚    - éå†æ¯ä¸ªèµ„æºç±»å‹                                     â”‚
â”‚    - åˆ›å»ºå¯¹åº”çš„å¯¼å…¥å™¨å®ä¾‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åº”ç”¨é€‚é…å™¨  â”‚   â”‚ 6. è§£æå¤–é”®     â”‚
â”‚ - timestamp    â”‚   â”‚ - åŸå§‹IDâ†’æ–°ID   â”‚
â”‚ - biz_id       â”‚   â”‚ - é€šè¿‡IDMapper  â”‚
â”‚ - user_info    â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å†²çªæ£€æµ‹ä¸å¤„ç†                                        â”‚
â”‚    - _check_conflict: æ£€æŸ¥æ˜¯å¦å­˜åœ¨                       â”‚
â”‚    - å­˜åœ¨ â†’ _handle_conflict: skip/overwrite/rename     â”‚
â”‚    - ä¸å­˜åœ¨ â†’ _create_object: åˆ›å»ºæ–°å¯¹è±¡                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è®°å½•IDæ˜ å°„                                            â”‚
â”‚    - add_mapping(resource_type, original_id, new_id)    â”‚
â”‚    - ä¿å­˜åˆ° ImportIDMapper                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. å¯¼å…¥å…³è”æ•°æ®                                          â”‚
â”‚    - import_relations: å¯¼å…¥ _relations ä¸­çš„æ•°æ®          â”‚
â”‚    - è‡ªåŠ¨è§£æå¤–é”®å…³è”åˆ°ä¸»å¯¹è±¡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. ç”Ÿæˆå¯¼å…¥ç»“æœ                                         â”‚
â”‚    - ç»Ÿè®¡ success/failed/skipped/total                  â”‚
â”‚    - è¿”å› id_mapping ä¾›åç»­ä½¿ç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å•ä¸ªå¯¹è±¡å¯¼å…¥æµç¨‹

```
import_single(data)
    â”‚
    â”œâ”€â†’ è·å–åŸå§‹ID: data["_metadata"]["original_id"]
    â”‚
    â”œâ”€â†’ åº”ç”¨é€‚é…å™¨: adapter_manager.apply_adapters(data)
    â”‚   â”‚
    â”‚   â”œâ”€â†’ TimestampImportAdapter: timestamp â†’ datetime
    â”‚   â”œâ”€â†’ BizIDImportAdapter: æ˜ å°„ bk_biz_id
    â”‚   â””â”€â†’ UserInfoImportAdapter: å¤„ç†ç”¨æˆ·å­—æ®µ
    â”‚
    â”œâ”€â†’ è§£æå¤–é”®: _resolve_foreign_keys(data)
    â”‚   â”‚
    â”‚   â””â”€â†’ éå†æ¨¡å‹çš„å¤–é”®å­—æ®µ
    â”‚       â””â”€â†’ é€šè¿‡ id_mapper.get_new_id() è·å–æ–°ID
    â”‚
    â”œâ”€â†’ æ£€æŸ¥å†²çª: _check_conflict(data)
    â”‚   â”‚
    â”‚   â”œâ”€â†’ å­˜åœ¨å†²çª â†’ _handle_conflict(data, existing_obj)
    â”‚   â”‚   â”œâ”€â†’ skip: è¿”å›å·²å­˜åœ¨å¯¹è±¡
    â”‚   â”‚   â”œâ”€â†’ overwrite: æ›´æ–°å·²å­˜åœ¨å¯¹è±¡
    â”‚   â”‚   â””â”€â†’ rename: é‡å‘½åååˆ›å»ºæ–°å¯¹è±¡
    â”‚   â”‚
    â”‚   â””â”€â†’ æ— å†²çª â†’ _create_object(data)
    â”‚       â””â”€â†’ ç§»é™¤ _metadata, _relations, pk_field
    â”‚       â””â”€â†’ model_class.objects.create(**import_data)
    â”‚
    â”œâ”€â†’ è®°å½•IDæ˜ å°„: id_mapper.add_mapping(resource_type, original_id, new_id)
    â”‚
    â””â”€â†’ å¯¼å…¥å…³è”æ•°æ®: import_relations(obj, relations)
        â”‚
        â””â”€â†’ éå† _relations ä¸­çš„æ•°æ®
            â””â”€â†’ import_related_queryset(...)
```

### 6.3 ä¾èµ–å…³ç³»å¤„ç†

å¯¼å…¥é¡ºåºç”± `EXPORT_ORDER` å®šä¹‰ï¼Œç¡®ä¿ä¾èµ–çš„èµ„æºå…ˆè¢«å¯¼å…¥ï¼š

```python
EXPORT_ORDER = [
    "duty_rule",          # 1. è½®å€¼è§„åˆ™ï¼ˆæœ€åŸºç¡€ï¼‰
    "user_group",         # 2. å‘Šè­¦ç»„ï¼ˆä¾èµ–è½®å€¼è§„åˆ™ï¼‰
    "action_plugin",      # 3. åŠ¨ä½œæ’ä»¶
    "action_config",      # 4. å¤„ç†å¥—é¤ï¼ˆä¾èµ–æ’ä»¶ï¼‰
    "strategy",           # 5. å‘Šè­¦ç­–ç•¥ï¼ˆä¾èµ–å‘Šè­¦ç»„ã€å¤„ç†å¥—é¤ï¼‰
    "alert_assign_group", # 6. å‘Šè­¦åˆ†æ´¾ï¼ˆä¾èµ–ç­–ç•¥ï¼‰
    "shield",             # 7. å‘Šè­¦å±è”½ï¼ˆä¾èµ–ç­–ç•¥ï¼‰
    "dashboard",          # 8. ä»ªè¡¨ç›˜
    "collector_plugin",   # 9. é‡‡é›†æ’ä»¶
    "collect_config",     # 10. é‡‡é›†é…ç½®ï¼ˆä¾èµ–æ’ä»¶ï¼‰
    "custom_ts_group",    # 11. è‡ªå®šä¹‰æ—¶åºåˆ†ç»„
    "custom_ts_table",    # 12. è‡ªå®šä¹‰æ—¶åºè¡¨ï¼ˆä¾èµ–åˆ†ç»„ï¼‰
]
```

### 6.4 å¤–é”®è§£ææµç¨‹

```
_resolve_foreign_keys(data)
    â”‚
    â”œâ”€â†’ è·å–æ¨¡å‹çš„æ‰€æœ‰å­—æ®µ: model_class._meta.get_fields()
    â”‚
    â”œâ”€â†’ éå†å­—æ®µï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯å¤–é”®
    â”‚   â”‚
    â”‚   â”œâ”€â†’ è·å–å…³è”æ¨¡å‹: field.related_model
    â”‚   â”œâ”€â†’ æ¨æ–­èµ„æºç±»å‹: _infer_resource_type(related_model)
    â”‚   â”‚
    â”‚   â””â”€â†’ å¦‚æœå­—æ®µå€¼å­˜åœ¨ä¸”æœ‰å¯¹åº”çš„èµ„æºç±»å‹
    â”‚       â”‚
    â”‚       â”œâ”€â†’ è·å–åŸå§‹ID: original_id = data[field_name]
    â”‚       â”œâ”€â†’ æŸ¥è¯¢æ–°ID: new_id = id_mapper.get_new_id(resource_type, original_id)
    â”‚       â””â”€â†’ æ›¿æ¢ID: data[field_name] = new_id
    â”‚
    â””â”€â†’ è¿”å›å¤„ç†åçš„ data
```

---

## æ‰©å±•å¼€å‘

### 7.1 æ·»åŠ æ–°çš„èµ„æºå¯¼å…¥å™¨

#### æ­¥éª¤1ï¼šåˆ›å»ºå¯¼å…¥å™¨ç±»

```python
# importers.py

class MyResourceImporter(BaseImporter, RelationImportMixin):
    """
    æˆ‘çš„èµ„æºå¯¼å…¥å™¨
    """
    resource_type = "my_resource"
    model_class = MyResourceModel
    
    def _check_conflict(self, data: dict):
        """è‡ªå®šä¹‰å†²çªæ£€æµ‹é€»è¾‘"""
        name = data.get("name")
        bk_biz_id = data.get("bk_biz_id")
        
        if name and bk_biz_id is not None:
            try:
                return self.model_class.objects.get(name=name, bk_biz_id=bk_biz_id)
            except self.model_class.DoesNotExist:
                pass
        return None
    
    def import_relations(self, obj, relations: dict):
        """å¯¼å…¥å…³è”æ•°æ®"""
        if "related_items" in relations:
            self.import_related_queryset(
                obj, "related_items", relations["related_items"], 
                RelatedModel, "my_resource_id"
            )
```

#### æ­¥éª¤2ï¼šæ³¨å†Œå¯¼å…¥å™¨

```python
# importers.py

IMPORTER_REGISTRY = {
    # ... ç°æœ‰å¯¼å…¥å™¨
    "my_resource": MyResourceImporter,
}
```

#### æ­¥éª¤3ï¼šæ·»åŠ åˆ°å¯¼å…¥é¡ºåºï¼ˆå¦‚æœéœ€è¦ï¼‰

```python
# export_utils.py (å¯¼å‡ºæ¨¡å—)

EXPORT_ORDER = [
    # ... ç°æœ‰é¡ºåº
    "my_resource",  # æ·»åŠ åˆ°åˆé€‚çš„ä½ç½®ï¼ˆè€ƒè™‘ä¾èµ–å…³ç³»ï¼‰
]
```

### 7.2 æ·»åŠ æ–°çš„å¯¼å…¥é€‚é…å™¨

#### æ­¥éª¤1ï¼šåˆ›å»ºé€‚é…å™¨ç±»

```python
# import_adapters.py

class MyCustomImportAdapter(BaseImportAdapter):
    """
    è‡ªå®šä¹‰å¯¼å…¥é€‚é…å™¨
    """
    
    def __init__(self, config: dict):
        super().__init__(config)
        self.my_config = config.get("my_adapter_config", {})
    
    def adapt(self, data: Any) -> Any:
        """
        é€‚é…æ•°æ®
        """
        if not isinstance(data, dict):
            return data
        
        # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        if "my_field" in data:
            data["my_field"] = self._transform_value(data["my_field"])
        
        return data
    
    def _transform_value(self, value):
        # è½¬æ¢é€»è¾‘
        return transformed_value
```

#### æ­¥éª¤2ï¼šåœ¨ ImportAdapterManager ä¸­å¯ç”¨

```python
# import_adapters.py

class ImportAdapterManager:
    def _initialize_adapters(self):
        adapters_config = self.config.get("adapters", {})
        
        # ... ç°æœ‰é€‚é…å™¨
        
        # æ·»åŠ è‡ªå®šä¹‰é€‚é…å™¨
        if adapters_config.get("my_adapter_config"):
            self.adapters.append(MyCustomImportAdapter(adapters_config))
```

#### æ­¥éª¤3ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨

```yaml
adapters:
  my_adapter_config:
    option1: "value1"
    option2: "value2"
```

### 7.3 è‡ªå®šä¹‰å†²çªæ£€æµ‹

```python
class CustomImporter(BaseImporter):
    def _check_conflict(self, data: dict):
        """
        ä½¿ç”¨è‡ªå®šä¹‰å­—æ®µç»„åˆä½œä¸ºå”¯ä¸€æ ‡è¯†
        """
        # ç¤ºä¾‹ï¼šä½¿ç”¨ code + type + bk_biz_id ä½œä¸ºå”¯ä¸€æ ‡è¯†
        code = data.get("code")
        type_ = data.get("type")
        bk_biz_id = data.get("bk_biz_id")
        
        if code and type_ and bk_biz_id is not None:
            try:
                return self.model_class.objects.get(
                    code=code, 
                    type=type_, 
                    bk_biz_id=bk_biz_id
                )
            except self.model_class.DoesNotExist:
                pass
        
        return None
```

---

## æœ€ä½³å®è·µ

### 8.1 å¯¼å…¥å‰å‡†å¤‡

1. **éªŒè¯å¯¼å‡ºæ–‡ä»¶**ï¼šç¡®è®¤å¯¼å‡ºæ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«å¿…éœ€å­—æ®µ
2. **è§„åˆ’ä¸šåŠ¡IDæ˜ å°„**ï¼šæå‰ç¡®å®šæºç¯å¢ƒå’Œç›®æ ‡ç¯å¢ƒçš„ä¸šåŠ¡IDå¯¹åº”å…³ç³»
3. **å¤‡ä»½ç›®æ ‡æ•°æ®**ï¼šå¯¼å…¥å‰å¤‡ä»½ç›®æ ‡ç¯å¢ƒçš„ç°æœ‰æ•°æ®
4. **æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å¯¼å…¥æµç¨‹

### 8.2 é…ç½®ç®¡ç†

1. **ä½¿ç”¨é…ç½®æ–‡ä»¶**ï¼šä¸è¦ç¡¬ç¼–ç é…ç½®ï¼Œä½¿ç”¨ YAML æ–‡ä»¶
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šå°†é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
3. **ç¯å¢ƒåˆ†ç¦»**ï¼šä¸ºä¸åŒç¯å¢ƒå‡†å¤‡ä¸åŒçš„é…ç½®æ–‡ä»¶
4. **æ˜ å°„å…³ç³»ç®¡ç†**ï¼šç»´æŠ¤ä¸šåŠ¡IDæ˜ å°„æ–‡æ¡£

### 8.3 å¯¼å…¥ç­–ç•¥é€‰æ‹©

| åœºæ™¯ | æ¨èç­–ç•¥ | è¯´æ˜ |
|------|---------|------|
| é¦–æ¬¡è¿ç§» | `skip` | é»˜è®¤ç­–ç•¥ï¼Œå®‰å…¨ |
| å¢é‡æ›´æ–° | `skip` | åªå¯¼å…¥æ–°å¢çš„é…ç½® |
| é…ç½®åŒæ­¥ | `overwrite` | è¦†ç›–ç°æœ‰é…ç½® |
| ä¿ç•™å†å² | `rename` | ä¿ç•™ä¸¤ä¸ªç‰ˆæœ¬ |

### 8.4 æ€§èƒ½ä¼˜åŒ–

1. **åˆ†æ‰¹å¯¼å…¥**ï¼šå¯¹äºå¤§é‡æ•°æ®ï¼Œè€ƒè™‘åˆ†æ‰¹å¯¼å…¥
2. **é€‰æ‹©æ€§å¯¼å…¥**ï¼šåªå¯¼å…¥éœ€è¦çš„èµ„æºç±»å‹
3. **å‡å°‘éªŒè¯**ï¼šå¦‚æœç¡®è®¤æ•°æ®æ­£ç¡®ï¼Œå¯ä»¥ç¦ç”¨éªŒè¯

### 8.5 é”™è¯¯å¤„ç†

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šå¯¼å…¥å¤±è´¥æ—¶æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. **æ£€æŸ¥æ˜ å°„**ï¼šç¡®è®¤ä¸šåŠ¡IDæ˜ å°„é…ç½®æ­£ç¡®
3. **éªŒè¯å¤–é”®**ï¼šæ£€æŸ¥å…³è”æ•°æ®çš„å¤–é”®æ˜¯å¦æ­£ç¡®è§£æ
4. **äº‹åŠ¡å›æ»š**ï¼šåˆ©ç”¨äº‹åŠ¡æœºåˆ¶ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

### 8.6 æ•°æ®å®‰å…¨

1. **æ•æ„Ÿä¿¡æ¯**ï¼šæ³¨æ„å¤„ç†å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿå­—æ®µ
2. **æƒé™æ§åˆ¶**ï¼šç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½æ‰§è¡Œå¯¼å…¥
3. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•å¯¼å…¥æ“ä½œï¼Œä¾¿äºå®¡è®¡

---

## å¸¸è§é—®é¢˜

### 9.1 å¯¼å…¥ç›¸å…³é—®é¢˜

**Q: å¯¼å…¥ç»“æœæ˜¾ç¤º id_mapping å€¼éƒ½æ˜¯ Noneï¼Ÿ**

A: è¿™æ˜¯å› ä¸ºå¯¼å‡ºæ–‡ä»¶ä¸­çš„ `id_mapping` å€¼éƒ½æ˜¯ `None`ï¼ˆå¯¼å‡ºæ—¶è¿˜ä¸çŸ¥é“å¯¼å…¥åçš„æ–°IDï¼‰ã€‚å¯¼å…¥å™¨ä¼šåœ¨å¯¼å…¥è¿‡ç¨‹ä¸­åŠ¨æ€å¡«å……å®é™…çš„æ–°IDã€‚å¦‚æœå¯¼å…¥å®Œæˆåä»ç„¶æ˜¯ `None`ï¼Œè¯´æ˜å¯¼å…¥è¿‡ç¨‹ä¸­æ²¡æœ‰æˆåŠŸåˆ›å»ºå¯¹è±¡ã€‚

**Q: å¯¼å…¥å¤±è´¥ï¼Œæç¤º"éœ€è¦æä¾›ä¸šåŠ¡IDæ˜ å°„"ï¼Ÿ**

A: å¯¼å‡ºæ•°æ®ä¸­æ ‡è®°äº† `_biz_id_mapping_required: true`ï¼Œä½†é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æä¾›å¯¹åº”çš„ä¸šåŠ¡IDæ˜ å°„ã€‚è¯·åœ¨é…ç½®æ–‡ä»¶çš„ `biz_id_mapping.mapping` ä¸­æ·»åŠ æ˜ å°„å…³ç³»ã€‚

**Q: å¦‚ä½•åªå¯¼å…¥ç‰¹å®šç±»å‹çš„èµ„æºï¼Ÿ**

A: åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® `resources`ï¼š
```yaml
import:
  resources: ["strategy", "dashboard"]
```

**Q: å¯¼å…¥çš„æ•°æ®å¤–é”®å…³è”é”™è¯¯ï¼Ÿ**

A: ç¡®ä¿æŒ‰ç…§æ­£ç¡®çš„ä¾èµ–é¡ºåºå¯¼å…¥èµ„æºã€‚è¢«ä¾èµ–çš„èµ„æºï¼ˆå¦‚ `user_group`ï¼‰åº”è¯¥å…ˆäºä¾èµ–å®ƒçš„èµ„æºï¼ˆå¦‚ `strategy`ï¼‰å¯¼å…¥ã€‚

### 9.2 é…ç½®ç›¸å…³é—®é¢˜

**Q: å†²çªå¤„ç†ç­–ç•¥å¦‚ä½•é€‰æ‹©ï¼Ÿ**

A:
- `skip`ï¼šé»˜è®¤ç­–ç•¥ï¼Œè·³è¿‡å·²å­˜åœ¨çš„å¯¹è±¡ï¼Œé€‚åˆå¢é‡å¯¼å…¥
- `overwrite`ï¼šè¦†ç›–å·²å­˜åœ¨çš„å¯¹è±¡ï¼Œé€‚åˆéœ€è¦æ›´æ–°ç°æœ‰é…ç½®çš„åœºæ™¯
- `rename`ï¼šé‡å‘½åæ–°å¯¹è±¡ï¼Œé€‚åˆéœ€è¦ä¿ç•™ä¸¤ä¸ªç‰ˆæœ¬çš„åœºæ™¯

**Q: ç”¨æˆ·ä¿¡æ¯å¤„ç†ç­–ç•¥å¦‚ä½•é€‰æ‹©ï¼Ÿ**

A:
- `keep`ï¼šä¿ç•™åŸå§‹ç”¨æˆ·ï¼Œé€‚åˆåŒç¯å¢ƒè¿ç§»æˆ–å¯ä¿¡ç¯å¢ƒ
- `replace`ï¼šæ›¿æ¢ä¸ºé»˜è®¤ç”¨æˆ·ï¼Œé€‚åˆè·¨ç¯å¢ƒè¿ç§»ä¸”ç”¨æˆ·ä½“ç³»ä¸åŒ
- `remove`ï¼šæ¸…ç©ºç”¨æˆ·å­—æ®µ

### 9.3 æŠ€æœ¯é—®é¢˜

**Q: æ—¶é—´æˆ³è½¬æ¢åæ—¶åŒºä¸æ­£ç¡®ï¼Ÿ**

A: `TimestampImportAdapter` ä½¿ç”¨ `datetime.fromtimestamp()` è½¬æ¢ï¼Œä¼šä½¿ç”¨ç³»ç»Ÿæœ¬åœ°æ—¶åŒºã€‚å¦‚æœéœ€è¦ç‰¹å®šæ—¶åŒºï¼Œå¯ä»¥è‡ªå®šä¹‰é€‚é…å™¨ã€‚

**Q: å¦‚ä½•å¤„ç†å¯¼å…¥è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ï¼Ÿ**

A: å¯¼å…¥è¿‡ç¨‹åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå•ä¸ªèµ„æºç±»å‹çš„å¯¼å…¥å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–èµ„æºç±»å‹ã€‚å¯ä»¥æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚

**Q: å¦‚ä½•æŸ¥çœ‹å¯¼å…¥äº†å“ªäº›èµ„æºï¼Ÿ**

A: æŸ¥çœ‹å¯¼å…¥ç»“æœçš„ `id_mapping` å­—æ®µï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰æˆåŠŸå¯¼å…¥çš„èµ„æºåŠå…¶IDæ˜ å°„å…³ç³»ã€‚

### 9.4 æ‰©å±•é—®é¢˜

**Q: å¦‚ä½•æ·»åŠ æ–°çš„èµ„æºç±»å‹ï¼Ÿ**

A: å‚è€ƒ [æ‰©å±•å¼€å‘ - æ·»åŠ æ–°çš„èµ„æºå¯¼å…¥å™¨](#71-æ·»åŠ æ–°çš„èµ„æºå¯¼å…¥å™¨)

**Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰é€‚é…å™¨ï¼Ÿ**

A: å‚è€ƒ [æ‰©å±•å¼€å‘ - æ·»åŠ æ–°çš„å¯¼å…¥é€‚é…å™¨](#72-æ·»åŠ æ–°çš„å¯¼å…¥é€‚é…å™¨)

**Q: å¦‚ä½•è‡ªå®šä¹‰å†²çªæ£€æµ‹é€»è¾‘ï¼Ÿ**

A: å‚è€ƒ [æ‰©å±•å¼€å‘ - è‡ªå®šä¹‰å†²çªæ£€æµ‹](#73-è‡ªå®šä¹‰å†²çªæ£€æµ‹)

---

## é™„å½•

### A. æ–‡ä»¶ç»“æ„

```
import_offshore_data/
â”œâ”€â”€ __init__.py               # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ import_config.py          # ä¸»å¯¼å…¥è„šæœ¬
â”œâ”€â”€ import_config.example.yaml # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ import_base.py            # åŸºç¡€å¯¼å…¥å™¨
â”œâ”€â”€ importers.py              # èµ„æºå¯¼å…¥å™¨å®ç°
â”œâ”€â”€ import_adapters.py        # æ•°æ®é€‚é…å™¨
â”œâ”€â”€ import_utils.py           # å·¥å…·å‡½æ•°
â”œâ”€â”€ example_import_usage.py   # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ IMPORT_FUNCTION_GUIDE.md  # æœ¬æ–‡æ¡£
```

### B. æ ¸å¿ƒç±»å’Œæ–¹æ³•

#### ConfigImporter
- `__init__(export_file, config_file, config_dict)`
- `import_all() -> dict`
- `get_import_summary() -> dict`

#### BaseImporter
- `should_import() -> bool`
- `import_all(resources_data) -> List[Model]`
- `import_single(data) -> Model`
- `import_relations(obj, relations)`
- `_check_conflict(data) -> Optional[Model]`
- `_handle_conflict(data, existing) -> Model`
- `_create_object(data) -> Model`
- `_resolve_foreign_keys(data) -> dict`

#### ImportAdapterManager
- `__init__(config)`
- `apply_adapters(data) -> Any`
- `get_applied_adapter_names() -> List[str]`

#### ImportIDMapper
- `add_mapping(resource_type, original_id, new_id)`
- `get_new_id(resource_type, original_id) -> Optional[Any]`
- `to_dict() -> dict`
- `from_dict(data: dict)`

### C. é…ç½®é¡¹é€ŸæŸ¥è¡¨

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|--------|------|
| `import.resources` | List[str] | `[]` | èµ„æºç±»å‹åˆ—è¡¨ |
| `import.conflict_strategy` | str | `"skip"` | å†²çªå¤„ç†ç­–ç•¥ |
| `import.validate` | bool | `true` | æ˜¯å¦éªŒè¯æ•°æ® |
| `adapters.biz_id_mapping.mapping` | dict | `{}` | ä¸šåŠ¡IDæ˜ å°„å…³ç³» |
| `adapters.user_mapping.strategy` | str | `"keep"` | ç”¨æˆ·å¤„ç†ç­–ç•¥ |
| `adapters.user_mapping.default_user` | str | `"admin"` | é»˜è®¤ç”¨æˆ· |
| `adapters.domain_mapping` | dict | `{}` | åŸŸåæ˜ å°„ |

### D. å¯¼å…¥å™¨æ³¨å†Œè¡¨

| èµ„æºç±»å‹ | å¯¼å…¥å™¨ç±» | æ¨¡å‹ç±» | ç‰¹æ®Šå¤„ç† |
|---------|---------|--------|---------|
| `strategy` | `StrategyImporter` | `StrategyModel` | å¯¼å…¥ Item, Detect, Algorithm |
| `user_group` | `UserGroupImporter` | `UserGroup` | å¯¼å…¥ DutyArrange, DutyRule |
| `duty_rule` | `DutyRuleImporter` | `DutyRule` | - |
| `action_config` | `ActionConfigImporter` | `ActionConfig` | - |
| `action_plugin` | `ActionPluginImporter` | `ActionPlugin` | - |
| `alert_assign_group` | `AlertAssignImporter` | `AlertAssignGroup` | å¯¼å…¥ AlertAssignRule |
| `shield` | `ShieldImporter` | `Shield` | - |
| `dashboard` | `DashboardImporter` | `Dashboard` | è‡ªå®šä¹‰å†²çªæ£€æµ‹ |
| `collect_config` | `CollectConfigImporter` | `CollectConfigMeta` | å¯¼å…¥ Plugin |
| `collector_plugin` | `CollectorPluginImporter` | `CollectorPluginMeta` | è‡ªå®šä¹‰å†²çªæ£€æµ‹ |
| `custom_ts_table` | `CustomTSTableImporter` | `CustomTSTable` | å¯¼å…¥ CustomTSField |
| `custom_ts_group` | `CustomTSGroupImporter` | `TimeSeriesGroup` | è‡ªå®šä¹‰å†²çªæ£€æµ‹ |

### E. å¯¼å‡ºæ–‡ä»¶æ ¼å¼

```json
{
  "version": "1.0",
  "export_time": 1737269400,
  "source_env": "production",
  "resources": {
    "strategy": [
      {
        "id": 100,
        "name": "CPUå‘Šè­¦ç­–ç•¥",
        "bk_biz_id": 100,
        "_biz_id_mapping_required": true,
        "_metadata": {
          "original_id": 100,
          "export_time": 1737269400
        },
        "_relations": {
          "items": [...],
          "detects": [...],
          "algorithms": [...]
        }
      }
    ]
  },
  "metadata": {
    "id_mapping": {
      "strategy": {"100": null, "101": null},
      "user_group": {"200": null}
    },
    "adapters_applied": ["TimestampAdapter", "BizIDAdapter"]
  }
}
```

### F. å‚è€ƒèµ„æº

- **é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š`import_config.example.yaml`
- **ä»£ç ç¤ºä¾‹**ï¼š`example_import_usage.py`
- **å¯¼å‡ºåŠŸèƒ½æ–‡æ¡£**ï¼š`../export_offshore_data/EXPORT_FUNCTION_GUIDE.md`

### G. æ›´æ–°æ—¥å¿—

- **v1.0** (2025-01-20)
  - åˆå§‹ç‰ˆæœ¬
  - æ”¯æŒ 12 ç§èµ„æºç±»å‹å¯¼å…¥
  - å®ç°æ•°æ®é€‚é…å™¨ç³»ç»Ÿ
  - å®ç° ID æ˜ å°„ç®¡ç†
  - æ”¯æŒä¸‰ç§å†²çªå¤„ç†ç­–ç•¥
  - è‡ªåŠ¨å¤–é”®è§£æ

---

## æ€»ç»“

æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»äº†ç›‘æ§é…ç½®å¯¼å…¥åŠŸèƒ½çš„è®¾è®¡ã€å®ç°å’Œä½¿ç”¨æ–¹æ³•ã€‚é€šè¿‡é˜…è¯»æœ¬æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… ç†è§£æ•´ä½“æ¶æ„å’Œè®¾è®¡æ€è·¯
2. âœ… æŒæ¡å„ä¸ªç»„ä»¶çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•
3. âœ… å­¦ä¼šé…ç½®å’Œä½¿ç”¨å¯¼å…¥åŠŸèƒ½
4. âœ… äº†è§£å¦‚ä½•æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½
5. âœ… è§£å†³å¸¸è§é—®é¢˜

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒä»£ç æ³¨é‡Šæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-20  
**ç»´æŠ¤è€…**: è“é²¸ç›‘æ§å›¢é˜Ÿ
